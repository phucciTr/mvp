var startEndIds = [];
var waypts = [];
var map, marker, infowindow, infowindowContent;

function initMap() {
  map = new google.maps.Map($('#map')[0], {
    center: { lat: -33.8688, lng: 151.2195 },
    zoom: 13
  });

  const directionsService = new google.maps.DirectionsService();
  const directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);

  $('#submit').click(() => calculateAndDisplayRoute(directionsService, directionsRenderer));

  const startPoint = $('#start-point')[0];
  const autocomplete = new google.maps.places.Autocomplete(startPoint);
  autocomplete.bindTo('bounds', map);

  const endPoint = $('#end-point')[0];
  const ep_autocomplete = new google.maps.places.Autocomplete(endPoint);
  ep_autocomplete.bindTo('bounds', map);

  const destinations = $('#waypoints')[0];
  const wp_autocomplete = new google.maps.places.Autocomplete(destinations);
  wp_autocomplete.bindTo('bounds', map);

  // Specify just the place data fields that you need.
  autocomplete.setFields(['place_id', 'geometry', 'name']);
  map.controls[google.maps.ControlPosition.TOP_LEFT].push(startPoint);

  ep_autocomplete.setFields(['place_id', 'geometry', 'name']);
  map.controls[google.maps.ControlPosition.LEFT_TOP].push(endPoint);

  wp_autocomplete.setFields(['place_id', 'geometry', 'name']);
  map.controls[google.maps.ControlPosition.TOP_LEFT].push(destinations);

  infowindow = new google.maps.InfoWindow();
  infowindowContent = $('#infowindow-content')[0];
  infowindow.setContent(infowindowContent);

  marker = new google.maps.Marker({ map: map });
  marker.addListener('click', () => {
    infowindow.open(map, marker);
  });

  autocomplete.addListener('place_changed', placeChangeHandler.bind(this, autocomplete, false));
  wp_autocomplete.addListener('place_changed', placeChangeHandler.bind(this, wp_autocomplete, true));
  ep_autocomplete.addListener('place_changed', placeChangeHandler.bind(this, ep_autocomplete, false));
}

var placeChangeHandler = (autocomp, isWaypt) => {

  infowindow.close();
  let place = autocomp.getPlace();

  if (!place.geometry) {
    return;
  }

  if (place.geometry.viewport) {
    map.fitBounds(place.geometry.viewport);
  } else {
    map.setCenter(place.geometry.location);
    map.setZoom(17);
  }

  // Set the position of the marker using the place ID and location.
  marker.setPlace({
    placeId: place.place_id,
    location: place.geometry.location
  });

  marker.setVisible(true);
  infowindowContent.children.namedItem('place-name').textContent = place.name;
  infowindowContent.children.namedItem('place-id').textContent = place.place_id;
  infowindowContent.children.namedItem('place-address').textContent = place.formatted_address;
  infowindow.open(map, marker);

  if (!isWaypt) {
    startEndIds.push(place.place_id);
  }
  if (isWaypt) {
    waypts.push(place.place_id);
  }
};

var calculateAndDisplayRoute = (directionsService, directionsRenderer) => {

  console.log('calculateAndDisplayRoute startEndIds = ', startEndIds);
  directionsService.route({
    origin: { placeId: startEndIds[0] },
    destination: { placeId: startEndIds[1] },
    // waypoints: waypts,
    // optimizeWaypoints: true,
    travelMode: google.maps.TravelMode.DRIVING
  }, (response, status) => {
    if (status === 'OK') {
      console.log('response = ', response);
      directionsRenderer.setDirections(response);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
};

export default initMap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvZ21hcEluaXQuanMiXSwibmFtZXMiOlsic3RhcnRFbmRJZHMiLCJ3YXlwdHMiLCJtYXAiLCJtYXJrZXIiLCJpbmZvd2luZG93IiwiaW5mb3dpbmRvd0NvbnRlbnQiLCJpbml0TWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsIiQiLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJ6b29tIiwiZGlyZWN0aW9uc1NlcnZpY2UiLCJEaXJlY3Rpb25zU2VydmljZSIsImRpcmVjdGlvbnNSZW5kZXJlciIsIkRpcmVjdGlvbnNSZW5kZXJlciIsInNldE1hcCIsImNsaWNrIiwiY2FsY3VsYXRlQW5kRGlzcGxheVJvdXRlIiwic3RhcnRQb2ludCIsImF1dG9jb21wbGV0ZSIsInBsYWNlcyIsIkF1dG9jb21wbGV0ZSIsImJpbmRUbyIsImVuZFBvaW50IiwiZXBfYXV0b2NvbXBsZXRlIiwiZGVzdGluYXRpb25zIiwid3BfYXV0b2NvbXBsZXRlIiwic2V0RmllbGRzIiwiY29udHJvbHMiLCJDb250cm9sUG9zaXRpb24iLCJUT1BfTEVGVCIsInB1c2giLCJMRUZUX1RPUCIsIkluZm9XaW5kb3ciLCJzZXRDb250ZW50IiwiTWFya2VyIiwiYWRkTGlzdGVuZXIiLCJvcGVuIiwicGxhY2VDaGFuZ2VIYW5kbGVyIiwiYmluZCIsImF1dG9jb21wIiwiaXNXYXlwdCIsImNsb3NlIiwicGxhY2UiLCJnZXRQbGFjZSIsImdlb21ldHJ5Iiwidmlld3BvcnQiLCJmaXRCb3VuZHMiLCJzZXRDZW50ZXIiLCJsb2NhdGlvbiIsInNldFpvb20iLCJzZXRQbGFjZSIsInBsYWNlSWQiLCJwbGFjZV9pZCIsInNldFZpc2libGUiLCJjaGlsZHJlbiIsIm5hbWVkSXRlbSIsInRleHRDb250ZW50IiwibmFtZSIsImZvcm1hdHRlZF9hZGRyZXNzIiwiY29uc29sZSIsImxvZyIsInJvdXRlIiwib3JpZ2luIiwiZGVzdGluYXRpb24iLCJ0cmF2ZWxNb2RlIiwiVHJhdmVsTW9kZSIsIkRSSVZJTkciLCJyZXNwb25zZSIsInN0YXR1cyIsInNldERpcmVjdGlvbnMiLCJ3aW5kb3ciLCJhbGVydCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsY0FBYyxFQUFsQjtBQUNBLElBQUlDLFNBQVMsRUFBYjtBQUNBLElBQUlDLEdBQUosRUFBU0MsTUFBVCxFQUFpQkMsVUFBakIsRUFBNkJDLGlCQUE3Qjs7QUFHQSxTQUFTQyxPQUFULEdBQW1CO0FBQ2pCSixRQUFNLElBQUlLLE9BQU9DLElBQVAsQ0FBWUMsR0FBaEIsQ0FBb0JDLEVBQUUsTUFBRixFQUFVLENBQVYsQ0FBcEIsRUFBa0M7QUFDdENDLFlBQVEsRUFBRUMsS0FBSyxDQUFDLE9BQVIsRUFBaUJDLEtBQUssUUFBdEIsRUFEOEI7QUFFdENDLFVBQU07QUFGZ0MsR0FBbEMsQ0FBTjs7QUFLQSxRQUFNQyxvQkFBb0IsSUFBSVIsT0FBT0MsSUFBUCxDQUFZUSxpQkFBaEIsRUFBMUI7QUFDQSxRQUFNQyxxQkFBcUIsSUFBSVYsT0FBT0MsSUFBUCxDQUFZVSxrQkFBaEIsRUFBM0I7QUFDQUQscUJBQW1CRSxNQUFuQixDQUEwQmpCLEdBQTFCOztBQUVBUSxJQUFFLFNBQUYsRUFBYVUsS0FBYixDQUFtQixNQUFNQyx5QkFBeUJOLGlCQUF6QixFQUE0Q0Usa0JBQTVDLENBQXpCOztBQUVBLFFBQU1LLGFBQWFaLEVBQUUsY0FBRixFQUFrQixDQUFsQixDQUFuQjtBQUNBLFFBQU1hLGVBQWUsSUFBSWhCLE9BQU9DLElBQVAsQ0FBWWdCLE1BQVosQ0FBbUJDLFlBQXZCLENBQW9DSCxVQUFwQyxDQUFyQjtBQUNBQyxlQUFhRyxNQUFiLENBQW9CLFFBQXBCLEVBQThCeEIsR0FBOUI7O0FBRUEsUUFBTXlCLFdBQVdqQixFQUFFLFlBQUYsRUFBZ0IsQ0FBaEIsQ0FBakI7QUFDQSxRQUFNa0Isa0JBQWtCLElBQUlyQixPQUFPQyxJQUFQLENBQVlnQixNQUFaLENBQW1CQyxZQUF2QixDQUFvQ0UsUUFBcEMsQ0FBeEI7QUFDQUMsa0JBQWdCRixNQUFoQixDQUF1QixRQUF2QixFQUFpQ3hCLEdBQWpDOztBQUVBLFFBQU0yQixlQUFlbkIsRUFBRSxZQUFGLEVBQWdCLENBQWhCLENBQXJCO0FBQ0EsUUFBTW9CLGtCQUFrQixJQUFJdkIsT0FBT0MsSUFBUCxDQUFZZ0IsTUFBWixDQUFtQkMsWUFBdkIsQ0FBb0NJLFlBQXBDLENBQXhCO0FBQ0FDLGtCQUFnQkosTUFBaEIsQ0FBdUIsUUFBdkIsRUFBaUN4QixHQUFqQzs7QUFFQTtBQUNBcUIsZUFBYVEsU0FBYixDQUF1QixDQUFDLFVBQUQsRUFBYSxVQUFiLEVBQXlCLE1BQXpCLENBQXZCO0FBQ0E3QixNQUFJOEIsUUFBSixDQUFhekIsT0FBT0MsSUFBUCxDQUFZeUIsZUFBWixDQUE0QkMsUUFBekMsRUFBbURDLElBQW5ELENBQXdEYixVQUF4RDs7QUFFQU0sa0JBQWdCRyxTQUFoQixDQUEwQixDQUFDLFVBQUQsRUFBYSxVQUFiLEVBQXlCLE1BQXpCLENBQTFCO0FBQ0E3QixNQUFJOEIsUUFBSixDQUFhekIsT0FBT0MsSUFBUCxDQUFZeUIsZUFBWixDQUE0QkcsUUFBekMsRUFBbURELElBQW5ELENBQXdEUixRQUF4RDs7QUFFQUcsa0JBQWdCQyxTQUFoQixDQUEwQixDQUFDLFVBQUQsRUFBYSxVQUFiLEVBQXlCLE1BQXpCLENBQTFCO0FBQ0E3QixNQUFJOEIsUUFBSixDQUFhekIsT0FBT0MsSUFBUCxDQUFZeUIsZUFBWixDQUE0QkMsUUFBekMsRUFBbURDLElBQW5ELENBQXdETixZQUF4RDs7QUFFQXpCLGVBQWEsSUFBSUcsT0FBT0MsSUFBUCxDQUFZNkIsVUFBaEIsRUFBYjtBQUNBaEMsc0JBQW9CSyxFQUFFLHFCQUFGLEVBQXlCLENBQXpCLENBQXBCO0FBQ0FOLGFBQVdrQyxVQUFYLENBQXNCakMsaUJBQXRCOztBQUVBRixXQUFTLElBQUlJLE9BQU9DLElBQVAsQ0FBWStCLE1BQWhCLENBQXVCLEVBQUVyQyxLQUFLQSxHQUFQLEVBQXZCLENBQVQ7QUFDQUMsU0FBT3FDLFdBQVAsQ0FBbUIsT0FBbkIsRUFBNEIsTUFBTTtBQUNoQ3BDLGVBQVdxQyxJQUFYLENBQWdCdkMsR0FBaEIsRUFBcUJDLE1BQXJCO0FBQ0QsR0FGRDs7QUFJQW9CLGVBQWFpQixXQUFiLENBQXlCLGVBQXpCLEVBQTBDRSxtQkFBbUJDLElBQW5CLENBQXdCLElBQXhCLEVBQThCcEIsWUFBOUIsRUFBNEMsS0FBNUMsQ0FBMUM7QUFDQU8sa0JBQWdCVSxXQUFoQixDQUE0QixlQUE1QixFQUE2Q0UsbUJBQW1CQyxJQUFuQixDQUF3QixJQUF4QixFQUE4QmIsZUFBOUIsRUFBK0MsSUFBL0MsQ0FBN0M7QUFDQUYsa0JBQWdCWSxXQUFoQixDQUE0QixlQUE1QixFQUE2Q0UsbUJBQW1CQyxJQUFuQixDQUF3QixJQUF4QixFQUE4QmYsZUFBOUIsRUFBK0MsS0FBL0MsQ0FBN0M7QUFDRDs7QUFHRCxJQUFJYyxxQkFBcUIsQ0FBQ0UsUUFBRCxFQUFXQyxPQUFYLEtBQXVCOztBQUU5Q3pDLGFBQVcwQyxLQUFYO0FBQ0EsTUFBSUMsUUFBUUgsU0FBU0ksUUFBVCxFQUFaOztBQUVBLE1BQUksQ0FBQ0QsTUFBTUUsUUFBWCxFQUFxQjtBQUFFO0FBQVM7O0FBRWhDLE1BQUlGLE1BQU1FLFFBQU4sQ0FBZUMsUUFBbkIsRUFBNkI7QUFDM0JoRCxRQUFJaUQsU0FBSixDQUFjSixNQUFNRSxRQUFOLENBQWVDLFFBQTdCO0FBQ0QsR0FGRCxNQUVPO0FBQ0xoRCxRQUFJa0QsU0FBSixDQUFjTCxNQUFNRSxRQUFOLENBQWVJLFFBQTdCO0FBQ0FuRCxRQUFJb0QsT0FBSixDQUFZLEVBQVo7QUFDRDs7QUFFRDtBQUNBbkQsU0FBT29ELFFBQVAsQ0FBZ0I7QUFDZEMsYUFBU1QsTUFBTVUsUUFERDtBQUVkSixjQUFVTixNQUFNRSxRQUFOLENBQWVJO0FBRlgsR0FBaEI7O0FBS0FsRCxTQUFPdUQsVUFBUCxDQUFrQixJQUFsQjtBQUNBckQsb0JBQWtCc0QsUUFBbEIsQ0FBMkJDLFNBQTNCLENBQXFDLFlBQXJDLEVBQW1EQyxXQUFuRCxHQUFpRWQsTUFBTWUsSUFBdkU7QUFDQXpELG9CQUFrQnNELFFBQWxCLENBQTJCQyxTQUEzQixDQUFxQyxVQUFyQyxFQUFpREMsV0FBakQsR0FBK0RkLE1BQU1VLFFBQXJFO0FBQ0FwRCxvQkFBa0JzRCxRQUFsQixDQUEyQkMsU0FBM0IsQ0FBcUMsZUFBckMsRUFBc0RDLFdBQXRELEdBQW9FZCxNQUFNZ0IsaUJBQTFFO0FBQ0EzRCxhQUFXcUMsSUFBWCxDQUFnQnZDLEdBQWhCLEVBQXFCQyxNQUFyQjs7QUFFQSxNQUFJLENBQUMwQyxPQUFMLEVBQWM7QUFBRTdDLGdCQUFZbUMsSUFBWixDQUFpQlksTUFBTVUsUUFBdkI7QUFBbUM7QUFDbkQsTUFBSVosT0FBSixFQUFhO0FBQUU1QyxXQUFPa0MsSUFBUCxDQUFZWSxNQUFNVSxRQUFsQjtBQUE4QjtBQUM5QyxDQTVCRDs7QUErQkEsSUFBSXBDLDJCQUEyQixDQUFDTixpQkFBRCxFQUFvQkUsa0JBQXBCLEtBQTJDOztBQUV4RStDLFVBQVFDLEdBQVIsQ0FBWSx5Q0FBWixFQUF1RGpFLFdBQXZEO0FBQ0FlLG9CQUFrQm1ELEtBQWxCLENBQ0U7QUFDRUMsWUFBUSxFQUFFWCxTQUFTeEQsWUFBWSxDQUFaLENBQVgsRUFEVjtBQUVFb0UsaUJBQWEsRUFBRVosU0FBU3hELFlBQVksQ0FBWixDQUFYLEVBRmY7QUFHRTtBQUNBO0FBQ0FxRSxnQkFBWTlELE9BQU9DLElBQVAsQ0FBWThELFVBQVosQ0FBdUJDO0FBTHJDLEdBREYsRUFRRSxDQUFDQyxRQUFELEVBQVdDLE1BQVgsS0FBc0I7QUFDcEIsUUFBSUEsV0FBVyxJQUFmLEVBQXFCO0FBQ25CVCxjQUFRQyxHQUFSLENBQVksYUFBWixFQUEyQk8sUUFBM0I7QUFDQXZELHlCQUFtQnlELGFBQW5CLENBQWlDRixRQUFqQztBQUNELEtBSEQsTUFHTztBQUNMRyxhQUFPQyxLQUFQLENBQWEsc0NBQXNDSCxNQUFuRDtBQUNEO0FBQ0YsR0FmSDtBQWtCRCxDQXJCRDs7QUF5QkEsZUFBZW5FLE9BQWYiLCJmaWxlIjoiZ21hcEluaXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgc3RhcnRFbmRJZHMgPSBbXTtcbnZhciB3YXlwdHMgPSBbXTtcbnZhciBtYXAsIG1hcmtlciwgaW5mb3dpbmRvdywgaW5mb3dpbmRvd0NvbnRlbnQ7XG5cblxuZnVuY3Rpb24gaW5pdE1hcCgpIHtcbiAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcCgkKCcjbWFwJylbMF0sIHtcbiAgICBjZW50ZXI6IHsgbGF0OiAtMzMuODY4OCwgbG5nOiAxNTEuMjE5NSB9LFxuICAgIHpvb206IDEzLFxuICB9KTtcblxuICBjb25zdCBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZSgpO1xuICBjb25zdCBkaXJlY3Rpb25zUmVuZGVyZXIgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKCk7XG4gIGRpcmVjdGlvbnNSZW5kZXJlci5zZXRNYXAobWFwKTtcblxuICAkKCcjc3VibWl0JykuY2xpY2soKCkgPT4gY2FsY3VsYXRlQW5kRGlzcGxheVJvdXRlKGRpcmVjdGlvbnNTZXJ2aWNlLCBkaXJlY3Rpb25zUmVuZGVyZXIpKTtcblxuICBjb25zdCBzdGFydFBvaW50ID0gJCgnI3N0YXJ0LXBvaW50JylbMF07XG4gIGNvbnN0IGF1dG9jb21wbGV0ZSA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKHN0YXJ0UG9pbnQpO1xuICBhdXRvY29tcGxldGUuYmluZFRvKCdib3VuZHMnLCBtYXApO1xuXG4gIGNvbnN0IGVuZFBvaW50ID0gJCgnI2VuZC1wb2ludCcpWzBdO1xuICBjb25zdCBlcF9hdXRvY29tcGxldGUgPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShlbmRQb2ludCk7XG4gIGVwX2F1dG9jb21wbGV0ZS5iaW5kVG8oJ2JvdW5kcycsIG1hcCk7XG5cbiAgY29uc3QgZGVzdGluYXRpb25zID0gJCgnI3dheXBvaW50cycpWzBdO1xuICBjb25zdCB3cF9hdXRvY29tcGxldGUgPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShkZXN0aW5hdGlvbnMpO1xuICB3cF9hdXRvY29tcGxldGUuYmluZFRvKCdib3VuZHMnLCBtYXApO1xuXG4gIC8vIFNwZWNpZnkganVzdCB0aGUgcGxhY2UgZGF0YSBmaWVsZHMgdGhhdCB5b3UgbmVlZC5cbiAgYXV0b2NvbXBsZXRlLnNldEZpZWxkcyhbJ3BsYWNlX2lkJywgJ2dlb21ldHJ5JywgJ25hbWUnXSk7XG4gIG1hcC5jb250cm9sc1tnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uVE9QX0xFRlRdLnB1c2goc3RhcnRQb2ludCk7XG5cbiAgZXBfYXV0b2NvbXBsZXRlLnNldEZpZWxkcyhbJ3BsYWNlX2lkJywgJ2dlb21ldHJ5JywgJ25hbWUnXSk7XG4gIG1hcC5jb250cm9sc1tnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uTEVGVF9UT1BdLnB1c2goZW5kUG9pbnQpO1xuXG4gIHdwX2F1dG9jb21wbGV0ZS5zZXRGaWVsZHMoWydwbGFjZV9pZCcsICdnZW9tZXRyeScsICduYW1lJ10pO1xuICBtYXAuY29udHJvbHNbZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLlRPUF9MRUZUXS5wdXNoKGRlc3RpbmF0aW9ucyk7XG5cbiAgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG4gIGluZm93aW5kb3dDb250ZW50ID0gJCgnI2luZm93aW5kb3ctY29udGVudCcpWzBdO1xuICBpbmZvd2luZG93LnNldENvbnRlbnQoaW5mb3dpbmRvd0NvbnRlbnQpO1xuXG4gIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoeyBtYXA6IG1hcCB9KTtcbiAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpbmZvd2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xuICB9KTtcblxuICBhdXRvY29tcGxldGUuYWRkTGlzdGVuZXIoJ3BsYWNlX2NoYW5nZWQnLCBwbGFjZUNoYW5nZUhhbmRsZXIuYmluZCh0aGlzLCBhdXRvY29tcGxldGUsIGZhbHNlKSk7XG4gIHdwX2F1dG9jb21wbGV0ZS5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIHBsYWNlQ2hhbmdlSGFuZGxlci5iaW5kKHRoaXMsIHdwX2F1dG9jb21wbGV0ZSwgdHJ1ZSkpO1xuICBlcF9hdXRvY29tcGxldGUuYWRkTGlzdGVuZXIoJ3BsYWNlX2NoYW5nZWQnLCBwbGFjZUNoYW5nZUhhbmRsZXIuYmluZCh0aGlzLCBlcF9hdXRvY29tcGxldGUsIGZhbHNlKSlcbn1cblxuXG52YXIgcGxhY2VDaGFuZ2VIYW5kbGVyID0gKGF1dG9jb21wLCBpc1dheXB0KSA9PiB7XG5cbiAgaW5mb3dpbmRvdy5jbG9zZSgpO1xuICBsZXQgcGxhY2UgPSBhdXRvY29tcC5nZXRQbGFjZSgpO1xuXG4gIGlmICghcGxhY2UuZ2VvbWV0cnkpIHsgcmV0dXJuOyB9XG5cbiAgaWYgKHBsYWNlLmdlb21ldHJ5LnZpZXdwb3J0KSB7XG4gICAgbWFwLmZpdEJvdW5kcyhwbGFjZS5nZW9tZXRyeS52aWV3cG9ydCk7XG4gIH0gZWxzZSB7XG4gICAgbWFwLnNldENlbnRlcihwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgbWFwLnNldFpvb20oMTcpO1xuICB9XG5cbiAgLy8gU2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgbWFya2VyIHVzaW5nIHRoZSBwbGFjZSBJRCBhbmQgbG9jYXRpb24uXG4gIG1hcmtlci5zZXRQbGFjZSh7XG4gICAgcGxhY2VJZDogcGxhY2UucGxhY2VfaWQsXG4gICAgbG9jYXRpb246IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLFxuICB9KTtcblxuICBtYXJrZXIuc2V0VmlzaWJsZSh0cnVlKTtcbiAgaW5mb3dpbmRvd0NvbnRlbnQuY2hpbGRyZW4ubmFtZWRJdGVtKCdwbGFjZS1uYW1lJykudGV4dENvbnRlbnQgPSBwbGFjZS5uYW1lO1xuICBpbmZvd2luZG93Q29udGVudC5jaGlsZHJlbi5uYW1lZEl0ZW0oJ3BsYWNlLWlkJykudGV4dENvbnRlbnQgPSBwbGFjZS5wbGFjZV9pZDtcbiAgaW5mb3dpbmRvd0NvbnRlbnQuY2hpbGRyZW4ubmFtZWRJdGVtKCdwbGFjZS1hZGRyZXNzJykudGV4dENvbnRlbnQgPSBwbGFjZS5mb3JtYXR0ZWRfYWRkcmVzcztcbiAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcblxuICBpZiAoIWlzV2F5cHQpIHsgc3RhcnRFbmRJZHMucHVzaChwbGFjZS5wbGFjZV9pZCk7IH1cbiAgaWYgKGlzV2F5cHQpIHsgd2F5cHRzLnB1c2gocGxhY2UucGxhY2VfaWQpOyB9XG59O1xuXG5cbnZhciBjYWxjdWxhdGVBbmREaXNwbGF5Um91dGUgPSAoZGlyZWN0aW9uc1NlcnZpY2UsIGRpcmVjdGlvbnNSZW5kZXJlcikgPT4ge1xuXG4gIGNvbnNvbGUubG9nKCdjYWxjdWxhdGVBbmREaXNwbGF5Um91dGUgc3RhcnRFbmRJZHMgPSAnLCBzdGFydEVuZElkcyk7XG4gIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKFxuICAgIHtcbiAgICAgIG9yaWdpbjogeyBwbGFjZUlkOiBzdGFydEVuZElkc1swXSB9LFxuICAgICAgZGVzdGluYXRpb246IHsgcGxhY2VJZDogc3RhcnRFbmRJZHNbMV0gfSxcbiAgICAgIC8vIHdheXBvaW50czogd2F5cHRzLFxuICAgICAgLy8gb3B0aW1pemVXYXlwb2ludHM6IHRydWUsXG4gICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5UcmF2ZWxNb2RlLkRSSVZJTkcsXG4gICAgfSxcbiAgICAocmVzcG9uc2UsIHN0YXR1cykgPT4ge1xuICAgICAgaWYgKHN0YXR1cyA9PT0gJ09LJykge1xuICAgICAgICBjb25zb2xlLmxvZygncmVzcG9uc2UgPSAnLCByZXNwb25zZSk7XG4gICAgICAgIGRpcmVjdGlvbnNSZW5kZXJlci5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5hbGVydCgnRGlyZWN0aW9ucyByZXF1ZXN0IGZhaWxlZCBkdWUgdG8gJyArIHN0YXR1cyk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG59O1xuXG5cblxuZXhwb3J0IGRlZmF1bHQgaW5pdE1hcDtcbiJdfQ==